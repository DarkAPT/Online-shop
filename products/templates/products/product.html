{% extends "base.html" %}
{% load static %}
{% load product_tags %}
{% load carts_tags %}

{% block meta %}
<meta name="csrf-token" content="{{ csrf_token }}">
{% endblock meta %}

{% block title %} {{title}} {% endblock title %}

    {% block css %}
    <link rel="stylesheet" href="{% static "products/css/product_page.css" %}">
    {% endblock css %}

{% block content %}
<div class="main">
    <div class="left_part">
        <div class="product_name"><h3>{{ product.name }}</h3></div>
        <div class="product_img">
            <img src="{{ product.image.url }}" alt="{{product.name}}">
        </div>
    </div>
    <div class="right_part">
        <div class="price_and_count">
            <div class="buy_price_count">
                <span style="color: rgb(182, 182, 182);">Артикул {{ product.display_id }}</span> <br>
                <span class="product_count">В наличии <span style="color: red;">{{ product.quantity }}</span> шт</span> <br>
                {% if product.discount != 0 %}
                <span class="new-price">{{ product.sell_price }}₽</span>
                <span class="discount">{{ product.discount }}%</span>
                <p class="old-price">{{ product.price_without_disc }}₽</p>
                {% else %}
                <span class="new-price">{{ product.price_without_disc }}₽</span>
                {% endif %}
                <div class="cart_button_favourite">
                    {% product_in_cart request product.id as prod_in_cart%}
                    {% if prod_in_cart %}
                    {% for cart in prod_in_cart %}
                    <div class="prod_quant" id="prod_quant">
                        <div class="minus">
                            <button id="minus " class="decrement" data-cart-id="{{cart.id}}" data-cart-change-url="{% url "cart:cart_change" %}">
                                {% csrf_token %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-dash" viewBox="0 0 16 16">
                                    <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/>
                                </svg>
                            </button>
                        </div>
                        <div class="quant">
                            <input class="number" inputmode="numeric" pattern="[0-9]*" type="number" name="" maxlength="4" value="{{cart.quantity}}" id="product_quantity" readonly>
                        </div>
                        <div class="plus">
                            <button id="plus " class="increment" data-cart-id="{{cart.id}}" data-cart-change-url="{% url "cart:cart_change" %}" data-max-quant="{{cart.product.quantity}}">
                                {% csrf_token %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    {% if product.quantity == 0 %}
                    <h5>Товара нет в наличии</h5>
                    {% else %}
                    <div class="prod_quant" >
                        <a href="{% url "cart:cart_add" %}" class="view-more add-to-cart" id="cart_button"
                        data-product-id="{{product.id}}">
                        В корзину</a>
                    </div>
                    {% endif %}
                    {% endif %}
                    {%product_in_favourites request product.id as prod_in_fav%}
                    <button class="favourites_add_remove" data-product-id="{{product.id}}" data-favourites-add-remove-url="{% url "cart:favourites_add_remove" %}" id="toggle-heart-button">
                        {% if prod_in_fav %}
                        <svg xmlns="http://www.w3.org/2000/svg" id="heart-svg" width="16" height="16" fill="red" class="bi bi-heart-fill" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"/>
                          </svg>
                          {% else %}
                          <svg xmlns="http://www.w3.org/2000/svg" id="heart-svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"/>
                          </svg>
                        {% endif %}
                    </button>
                </div>
            </div>
            <div class="brand_img">
                <img src="{{ product.brand_image.url}}" alt="Картинка бренда">
            </div>
        </div>
        <div class="description" id="description">
            <div class="descr_buttons" id="descr_buttons">
                <button onclick="product_description()" id="active"><span>Описание</span></button>
                <button onclick="product_param()" id="not_active"><span >Характеристики</span></button>
            </div>
            <div class="div_active" id="description_div">
                <span class="text_description">{{ product.description }}</span>
            </div>
            <div class="div_hidden" id="product-param_div">
                <div class="product-param">
                    {% tag_characteristics_sets as CharacteristicsSet %}
                    {% for property in CharacteristicsSet %}
                    {% if property.productid.id == product.id %}
                    <div class="p-p">
                        <i>{{ property.propertyid.name }}:</i>
                        <span>{{ property.propertyvalueid.value }}</span>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block js %}
    <script src="{% static "products/js/product_description.js" %}"></script>
    <script src="{% static "products/js/product_page_description_size.js" %}"></script>
{% endblock js %}